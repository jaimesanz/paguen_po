{% extends "base.html" %}
{% load bootstrap3 %}
{% load humanize %}
{% load static %}

{% block custom_head %}
	{% include "general/datatables.html" %}
{% endblock %}

{% block content_title %}{{request.user.get_vivienda}}{% endblock %}

{% block subtitle %}
    Gastos
{% endblock %}

{% block buttons %}
    <a href="{% url 'graph_gastos' %}" class="btn btn-primary" role="button">
		{% bootstrap_icon "signal" %} Gráficos
	</a>
    <a href="{% url 'get_gastos_xls' %}" class="btn btn-warning" role="button">
		{% bootstrap_icon "arrow-down" %} .xls
	</a>
{% endblock %}

{% block content %}
	<!-- Nav tabs -->
	<ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="active"><a href="#nuevo_gasto" aria-controls="nuevo_gasto" role="tab" data-toggle="tab">Nuevo Gasto</a></li>
		<li role="presentation"><a href="#pendientes" aria-controls="pendientes" role="tab" data-toggle="tab">Pendientes</a></li>
		<li role="presentation"><a href="#pendientes_confirmacion" aria-controls="pendientes_confirmacion"
                                   role="tab" data-toggle="tab">Por
            Confirmar</a></li>
        <li role="presentation"><a href="#pagados" aria-controls="pagados" role="tab" data-toggle="tab">Pagados</a></li>
	</ul>
	<br>

	<!-- Tab panes -->
	<div class="tab-content">
		<!-- nuevo gasto -->
		<div role="tabpanel" class="tab-pane active" id="nuevo_gasto">
			<form action="/nuevo_gasto/" method="POST">
				{% csrf_token %}
				{% bootstrap_form gasto_form %}
				<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
					<div class="btn-group" data-toggle="buttons">
						<label class="btn btn-success active">
							<input type="radio" name="is_paid" value="no" id="id_pending_option" autocomplete="off" checked>Pendiente
						</label>
						<label class="btn btn-success">
							<input type="radio" name="is_paid" value="yes" id="id_paid_option" autocomplete="off">Pagado
						</label>
					</div>
					<div class="btn-group" role="group" aria-label="Third group">
						{% bootstrap_button "Generar" button_type="submit" name="create_gasto_btn" button_class="btn-primary" %}
					</div>
				</div>
				<br><br>
			</form>
		</div>

		<!-- pendientes -->
		<div role="tabpanel" class="tab-pane" id="pendientes">
			<table id="tabla_gastos_pendientes" class="table table-striped table-bordered" cellspacing="0" width="100%">
			    <thead>
			        <tr>
			            <th>Fecha</th>
			            <th>Categoría</th>
			            <th>Monto</th>
			        </tr>
			    </thead>
			    <tbody>
			        {% for gasto in gastos_pendientes_list %}
			        	<tr>
				            <td><a href="{% url 'detalle_gasto' gasto.id %}"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span></a> {{gasto.fecha_creacion}}</td>
				            <td>{{gasto.categoria}}</td>
				            <td>$ {{gasto.monto|intcomma}}</td>
			        	</tr>
			        {% endfor %}
			    </tbody>
			</table>
		</div>

        <!-- pendientes confirmacion -->
		<div role="tabpanel" class="tab-pane" id="pendientes_confirmacion">
			<table id="tabla_gastos_pendientes_confirmacion" class="table
			table-striped table-bordered" cellspacing="0" width="100%">
			    <thead>
			        <tr>
			            <th>Fecha</th>
			            <th>Categoría</th>
			            <th>Monto</th>
			        </tr>
			    </thead>
			    <tbody>
			        {% for gasto in gastos_pendientes_confirmacion_list %}
			        	<tr>
				            <td><a href="{% url 'detalle_gasto' gasto.id %}"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span></a> {{gasto.fecha_creacion}}</td>
				            <td>{{gasto.categoria}}</td>
				            <td>$ {{gasto.monto|intcomma}}</td>
			        	</tr>
			        {% endfor %}
			    </tbody>
			</table>
		</div>

		<!-- pagados -->
		<div role="tabpanel" class="tab-pane" id="pagados">
			<div role="tabpanel" class="tab-pane" id="pendientes">
				<table id="tabla_gastos_pagados" class="table table-striped table-bordered" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Fecha Pago</th>
							<th>Categoría</th>
							<th>Monto</th>
						</tr>
					</thead>
					<tbody>
						{% for gasto in gastos_pagados_list %}
						<tr>
							<td><a href="{% url 'detalle_gasto' gasto.id %}"><span class="glyphicon glyphicon-log-in" aria-hidden="true"></span></a> {{gasto.fecha_pago}}</td>
							<td>{{gasto.categoria}}</td>
							<td>$ {{gasto.monto|intcomma}}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>

    {% bootstrap_button "Generar Gasto" name="confirmSubmit" button_class="btn-primary" as confirm_button %}
    {% include "general/modal.html" with modal_id="ConfirmModal" modal_title="Confirme los datos" modal_body="<p>Revise que los datos ingresados estén correctos antes de generar el gasto.</p>"|add:confirm_button  %}

	<script type='text/javascript' src='{% static 'js/jquery.ui.datepicker-es.js' %}'></script>
	<script type="text/javascript">
		$(document).ready(function(){

            $("button[name='create_gasto_btn']").click(function () {
                $("#ConfirmModal").modal();
                return false;
            });
            $("button[name='confirmSubmit']").click(function () {
                $("form").submit();
            });

			$("#id_fecha_pago").datepicker();
			$('#tabla_gastos_pendientes, #tabla_gastos_pagados, #tabla_gastos_pendientes_confirmacion').each
            (function(){
				$(this).DataTable({});
			});
			$("#id_fecha_pago").parent().hide();
			$("#id_pending_option").parent().click(function(){
				$("#id_fecha_pago").parent().hide();
			});
			$("#id_paid_option").parent().click(function(){
				$("#id_fecha_pago").parent().show();
			});
		});
	</script>
{% endblock %}

{% block info_title %}
    Sobre los Gastos
{% endblock %}

{% block info_content %}
    Un <i>Gasto</i> corresponde a:
    <ul>
        <li>algo que debe ser pagado (estado "pendiente")</li>
        <li>algo que ya fué pagado (estado "pagado")</li>
    </ul>
    Al crear un Gasto <b>pendiente</b>, este puede ser pagado por cualquier otro
    usuario de la Vivienda.
    <br><br>
    Por ejemplo, un usuario puede ingresar la cuenta
    de la Luz y dejar el registro de cuánto se <i>debe</i> pagar, para que
    luego otro usuario efectivamente realice el pago. Esto sirve como un
    recordatorio para que la cuenta no quede en el olvido.
    <br><br>
    Por otro lado, al crear un Gasto <b>pagado</b>, inmediatamente queda el
    registro de que fue Usted quien pagó el Gasto. Sin embargo, no se marca
    inmediatamente como "pagado", sino como "pendiente_confirmación".
    <br><br>
    Una vez que el Gasto es confirmado por todos sus compañeros, se cambia el
    estado a "pagado", <b>y sólo entonces se considera el Gasto para el
    computo de totales por período y para el balance.</b>
    <br><br>
    Si hace click en el botón ".xls" puede descargar el historial de gastos
    en formato Excel.
{% endblock %}
